[
  {
    "groupId": "VIIRS",
    "triggers": [
      {
        "type": "timer",
        "period_s": 600,
        "event": "http-tile-ingest-needed",
        "transactions": [
          {"product": "VNGCR_LQD_C1", "parameterName": "VNGCR_LQD_I1-M4-M3_NRT", "epsg": 4326, "zoom": 9},
          {"product": "VNGCR_SQD_C1", "parameterName": "VNGCR_SQD_I1-M4-M3_NRT", "epsg": 3031, "zoom": 6},
          {"product": "VNGCR_NQD_C1", "parameterName": "VNGCR_NQD_I1-M4-M3_NRT", "epsg": 3413, "zoom": 6}
        ]
      }
    ],
    "tasks": {
      "DiscoverHttpTiles": {
        "root": "http://lance3.modaps.eosdis.nasa.gov/imagery/elements/{groupId}/{product}/",
        "pattern": "http://lance3.modaps.eosdis.nasa.gov/imagery/elements/{groupId}/{product}/{_}/{jday}/{file}.{ext}",
        "endpoint": "apache-index",
        "transaction": {
          "key": "{groupId}/{product}/{jday}",
          "date": {
            "type": "date",
            "value": "{jday}"
          }
        },
        "required": [
          {
            "group": "{file}",
            "prop": "ext",
            "values": [
              "jgw",
              "jpg",
              "txt"
            ]
          }
        ]
      },
      "SyncHttpUrls": {
        "output": {
          "Bucket": "{bucket}",
          "Key": "sources/EPSG{epsg}/{key}"
        }
      },
      "GenerateMrf": {
        "output": {
          "Bucket": "{mrf_bucket}",
          "Key": "EPSG{epsg}/{product}/{date.year}"
        },
        "mrfgen": {
          "mrf_compression_type": "JPEG",
          "source_epsg": "{epsg}",
          "mrf_merge": false,
          "mrf_nocopy": true,
          "overview_resampling": "average",
          "resize_resampling": "average",
          "parameter_name": "{parameterName}"
        }
      }
    }
  },
  {
    "groupId": "MOPITT",
    "triggers": [
      {
        "type": "timer",
        "period_s": 600,
        "event": "cmr-ingest-needed",
        "transactions": [
          {
            "concept_id": "C190698050-LARC",
            "product": "MOPITT_DCOSMR_LL_D_STD",
            "colormap": "MOPITT_CO_Daily_Surface_Mixing_Ratio_Day.xml",
            "epsg": 4326,
            "zoom": 6,
            "wms": {
              "layer": "MOP03J.006/RetrievedCOSurfaceMixingRatioDay",
              "style": "se_mopitt_threshold_retrievedcosurfacemixingratioday_mop03j"
            }
          },
          {
            "concept_id": "C191855459-LARC",
            "product": "MOPITT_MCOSMR_LL_D_STD",
            "colormap": "MOPITT_CO_Daily_Surface_Mixing_Ratio_Day.xml",
            "epsg": 4326,
            "zoom": 6,
            "wms": {
              "layer": "MOP03JM.006/RetrievedCOSurfaceMixingRatioDay",
              "style": "se_mopitt_threshold_retrievedcosurfacemixingratioday_mop03jm"
            }
          },
          {
            "concept_id": "C190698050-LARC",
            "product": "MOPITT_DCOSMR_LL_A_STD",
            "colormap": "MOPITT_CO_Daily_Surface_Mixing_Ratio_Night.xml",
            "epsg": 4326,
            "zoom": 6,
            "wms": {
              "layer": "MOP03J.006/RetrievedCOSurfaceMixingRatioNight",
              "style": "se_mopitt_threshold_retrievedcosurfacemixingrationight_mop03j"
            }
          },
          {
            "concept_id": "C191855459-LARC",
            "product": "MOPITT_MCOSMR_LL_A_STD",
            "colormap": "MOPITT_CO_Daily_Surface_Mixing_Ratio_Night.xml",
            "epsg": 4326,
            "zoom": 6,
            "wms": {
              "layer": "MOP03JM.006/RetrievedCOSurfaceMixingRatioNight",
              "style": "se_mopitt_threshold_retrievedcosurfacemixingrationight_mop03jm"
            }
          },
          {
            "concept_id": "C190698050-LARC",
            "product": "MOPITT_DCOTC_LL_D_STD",
            "colormap": "MOPITT_CO_Daily_Total_Column_Day.xml",
            "epsg": 4326,
            "zoom": 6,
            "wms": {
              "layer": "MOP03J.006/RetrievedCOTotalColumnDay",
              "style": "se_mopitt_threshold_retrievedcototalcolumnday_mop03j"
            }
          },
          {
            "concept_id": "C191855459-LARC",
            "product": "MOPITT_MCOTC_LL_D_STD",
            "colormap": "MOPITT_CO_Daily_Total_Column_Day.xml",
            "epsg": 4326,
            "zoom": 6,
            "wms": {
              "layer": "MOP03JM.006/RetrievedCOTotalColumnDay",
              "style": "se_mopitt_threshold_retrievedcototalcolumnday_mop03jm"
            }
          },
          {
            "concept_id": "C190698050-LARC",
            "product": "MOPITT_DCOTC_LL_A_STD",
            "colormap": "MOPITT_CO_Daily_Total_Column_Night.xml",
            "epsg": 4326,
            "zoom": 6,
            "wms": {
              "layer": "MOP03J.006/RetrievedCOTotalColumnNight",
              "style": "se_mopitt_threshold_retrievedcototalcolumnnight_mop03j"
            }
          },
          {
            "concept_id": "C191855459-LARC",
            "product": "MOPITT_MCOTC_LL_A_STD",
            "colormap": "MOPITT_CO_Daily_Total_Column_Night.xml",
            "epsg": 4326,
            "zoom": 6,
            "wms": {
              "layer": "MOP03JM.006/RetrievedCOTotalColumnNight",
              "style": "se_mopitt_threshold_retrievedcototalcolumnnight_mop03jm"
            }
          }
        ]
      }
    ],
    "tasks": {
      "DiscoverCmrGranules": {
        "root": "https://cmr.earthdata.nasa.gov",
        "since": "20d",
        "event": "wms-map-found",
        "transaction": {
          "key": "{product}/{id}",
          "granule_id": "{id}",
          "version": "{updated}",
          "date": {
            "type": "date",
            "value": "{time_start}"
          }
        }
      },
      "SyncWms": {
        "filename": "{key}.png",
        "getmap": "https://opendap.larc.nasa.gov/ncWMS-2.0/wms?REQUEST=GetMap&VERSION=1.3.0&STYLES={wms.style}&CRS=CRS:84&WIDTH=640&HEIGHT=320&FORMAT=image/png&TRANSPARENT=true&LAYERS={wms.layer}&BBOX=-180,-90,180,90&&time={date.isoDateTime}"
      },
      "SyncHttpUrls": {
        "output": {
          "Bucket": "{bucket}",
          "Key": "sources/EPSG{epsg}"
        }
      },
      "GenerateMrf": {
        "output": {
          "Bucket": "{mrf_bucket}",
          "Key": "EPSG{epsg}/{product}/{date.year}"
        },
        "files": [
          { "Bucket": "{config_bucket}", "Key": "ingest/colormaps/{colormap}" },
          { "Bucket": "{config_bucket}", "Key": "ingest/empty_tiles/{product}.png" },
          { "filename": "{granule_id}.pgw", "contents": "0.5625\n0\n0\n-0.5625\n-179.4375\n89.4375" }
        ],
        "mrfgen": {
          "mrf_compression_type": "PPNG",
          "source_epsg": "{epsg}",
          "mrf_merge": false,
          "mrf_nocopy": false,
          "overview_resampling": "nearest",
          "resize_resampling": "near",
          "parameter_name": "{product}",
          "colormap": "{{{paths.input}}}/{colormap}",
          "mrf_empty_tile_filename": "{{{paths.input}}}/{product}.png"
        }
      }
    }
  }
]
