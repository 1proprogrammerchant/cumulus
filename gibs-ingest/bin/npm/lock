#!/bin/bash

set -e

if [[ `npm --version` =~ ^[012]\.* ]]; then
    echo "ERROR: Version locking requires npm >= 3.0.0"
    exit 1
fi

# Running this scripts will lock down the dependencies exported

find . -name package.json \
     -not -path './test/*' \
     -not -path '*/node_modules/*' \
     -execdir npm prune \;

find . -name package.json \
     -not -path './test/*' \
     -not -path '*/node_modules/*' \
     -execdir npm shrinkwrap --dev \;

npm install
